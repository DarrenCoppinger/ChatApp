<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ChatApp</title>

    <!--    Bootstrap-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!--  fontawesome-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css" integrity="sha384-jLKHWM3JRmfMU0A5x5AkjWkw/EYfGUAGagvnfryNV3F9VqM98XiIH7VBGVoxVSc7" crossorigin="anonymous">
    <!--    CSS-->
    <link rel="stylesheet" href="static/css/style.css">
<!--    <link rel="script" href="static/js/chat.js">-->
  </head>
  <body>
    <header></header>
    <main>
      <section>
        <div class="container">
          <div class="row mt-5">
            <div class="col-12">
              <form id="form">
                <div class="form-group mb-3">
                  <label for="exampleFormControlInput1" class="form-label">Handle</label>
                  <input type="text" class="form-control" id="exampleFormControlInput1" placeholder="@handle" required>
                </div>
                <div class="form-group mb-3">
                  <label for="exampleFormControlTextarea1" class="form-label">Comment</label>
                  <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" placeholder="Write something here" required></textarea>
                </div>
                <div class="form-group mb-3">
                  <button type="submit" class="btn btn-primary mb-3">Post Comment</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </section>
      <section>
        <div class="container">
          <div class="row mt-5">
            <div class="col-12">
              <div id="commentSection">Something here</div>
            </div>
          </div>
        </div>
      </section>
    </main>
    <footer>

    </footer>

    <script>
      // var form = document.getElementsByTagName('form')[0]
      var comment = [];
      var handle;
      var text;
      var timeTest;
      var timeTest1;
      var timeTest2;
      var timeTest3;
      var timeTest4;
      var handleID = document.getElementById('exampleFormControlInput1')
      var textID = document.getElementById('exampleFormControlTextarea1');
      var form = document.getElementById('form');
      var postdate;
      var timeDiff;
      var timeStamp;
      var totalLikes =0;

      var sHTML = "No Comments";

      var commentSectionID = document.getElementById('commentSection');
      commentSectionID.innerHTML = sHTML;
      timetest =  (Date.now() - 60000);  //1 mins
      timetest0 = (Date.now() - 300000);  //5 mins
      timetest1 = (Date.now() - 3600000);  //1 hour
      timetest2 = (Date.now() - 18000000);  //5 hours
      timetest3 = (Date.now() - 86400000); //yesterday
      timetest4 = (Date.now() - 172800000);  //>yesterday
      comment.push({handle:"Sunshine", text:"Test-4", postdate:timetest4});
      comment.push({handle:"Sunshine", text:"Test-3", postdate:timetest3});
      comment.push({handle:"Sunshine", text:"Test-2", postdate:timetest2});
      comment.push({handle:"Sunshine", text:"Test-1", postdate:timetest1});
      comment.push({handle:"Sunshine", text:"Test0", postdate:timetest0});
      comment.push({handle:"Sunshine", text:"Test", postdate:timetest});

      function addComment(event){
        event.preventDefault();
        postdate = Date.now();
        comment.push({handle:handleID.value, text:textID.value, postdate:postdate});
        displayComments();
        form.reset();

        console.log("timeStamp = " + timeStamp);

      }

      function displayComments(){
        sHTML = "";
        console.log("length= " + comment.length);

        // console.log("handle" + comment[i].handle);
        // console.log("text" + comment[i].text);

        for(var i=(comment.length-1); i>=0; i--){
        //for(var i=0; i<comment.length; i++){
        //   console.log("i " + i);
        //   console.log("comment " + comment[i]);
        //   console.log("handle " + comment[i].handle);
        //   console.log("text " + comment[i].text);
        //   console.log("postdate " + comment[i].postdate);
          timeDiff =((Date.now() - comment[i].postdate)/1000);
          console.log("timeDiff " + timeDiff);
           if(timeDiff<2) {
             timeStamp = "Posted about a second ago";
           }else if(2<=timeDiff && timeDiff<60){
               timeStamp = "Posted about " + Math.round(timeDiff) + " seconds ago";
           }else if(60<=timeDiff && timeDiff<120){
             timeStamp = "Posted about 1 minute ago";
           }else if(120<=timeDiff && timeDiff<3600){
             timeStamp = "Posted about " + Math.round(timeDiff/60) + " minutes ago";
           }else if(3600<=timeDiff && timeDiff<7200){
             timeStamp= "Posted about 1 hour ago";
           }else if(7200<=timeDiff && timeDiff<86400){
             timeStamp= "Posted about " + Math.round(timeDiff/3600) + " hours ago";
           }else if(86400<=timeDiff && timeDiff<172800){
             timeStamp = "Posted yesterday";
           } else {
             var time = comment[i].postdate;
             //console.log("time= "+ time.getMonth());
             // var dd = String(time.getDate()).padStart(2, '0');
             // var mm = String(time.getMonth() + 1).padStart(2, '0'); //January is 0!
             // var yyyy = time.getFullYear();

             timeStamp = "Posted on " + time;
           }

          sHTML +="<div class=\"card bg-light\" style=\"width: 18rem;\"> \n" +
                  "<div class=\"card-body\"> \n " +
                  "<h5 className=\"card-title\">@" + comment[i].handle + "</h5> \n" +
                  "<small className=\"card-subtitle mb-2 text-muted\">"  +  timeStamp +  "</small> \n" +
                  "<p class=\"card-text mt-3\">" + comment[i].text + "</p> \n" +
                  "<p><button class=\"btn btn-primary\" onclick=\'addLike();\'>Like</button>" + "</p> \n " +
                  "</div>" +
                  "</div>" +
                  "<BR>";
        }
        console.log("sHTML= "+ sHTML)
        commentSectionID.innerHTML = sHTML;
      }

      function addLike(){
        totalLikes++;
        alert(" Total likes = "+ totalLikes)
      }

      form.addEventListener("submit", addComment)
    </script>
  </body>
</html>
